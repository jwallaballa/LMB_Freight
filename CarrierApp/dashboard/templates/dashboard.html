<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LMB Freight Dashboard</title>
<style>
/* Reset & basic */
body, html {
    margin: 0;
    padding: 0;
    font-family: Arial, sans-serif;
    background-color: #f4f4f4;
}

/* Layout */
body {
    display: flex;
    min-height: 100vh;
}
.sidebar {
    width: 220px;
    background-color: #1e5732;
    color: white;
    padding: 20px;
}
.sidebar h2 {
    margin-bottom: 30px;
}
.sidebar ul {
    list-style: none;
    padding: 0;
}
.sidebar ul li {
    margin: 15px 0;
}
.sidebar ul li a {
    color: white;
    text-decoration: none;
    display: block;
    padding: 8px;
    border-radius: 5px;
}
.sidebar ul li a:hover {
    background-color: #374151;
}

.main-content {
    flex: 1;
    padding: 20px;
}

/* Header */
.main-content h1 {
    color: #111827;
}

/* Stats cards */
.stats {
    display: flex;
    gap: 20px;
    margin-bottom: 20px;
}
.card {
    flex: 1;
    background-color: #49a942;
    color: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 3px 6px rgba(0,0,0,0.1);
    text-align: center;
}
.card h3 {
    margin-bottom: 10px;
    font-weight: normal;
    font-size: 1rem;
}
.card p {
    font-size: 1.5rem;
    font-weight: bold;
}

/* Controls */
.controls {
    margin-bottom: 20px;
}
.controls a {
    padding: 10px 15px;
    background-color: #49a942;
    color: white;
    text-decoration: none;
    border-radius: 5px;
}
#search, #rows-per-page {
    padding: 8px 12px;
    border-radius: 5px;
    border: 1px solid #ddd;
    margin-left: 10px;
}

/* Table */
table {
    width: 100%;
    border-collapse: collapse;
    background: white;
}
th, td {
    padding: 10px;
    text-align: left;
}
th {
    background-color: #49a942;
    color: white;
    position: sticky;
    top: 0;
    cursor: pointer;
}
tbody tr:nth-child(even) {
    background-color: #f9f9f9;
}
tbody tr:hover {
    background-color: #e0f7ff;
}
td[contenteditable="true"]:hover {
    background-color: #fff3cd;
}

/* Notification */
.notification {
    position: fixed;
    top: 20px;
    right: -300px;
    background-color: #4CAF50;
    color: white;
    padding: 10px 20px;
    border-radius: 5px;
    z-index: 1000;
    transition: right 0.3s ease;
}
.notification.show {
    right: 20px;
}

/* Charts placeholder */
.chart-container {
    margin-top: 30px;
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

/* Status dropdown */
.status-select {
    width: 100%;
    padding: 4px 6px;
    border-radius: 5px;
    border: 1px solid #ccc;
    font-size: 0.9rem;
}
</style>
</head>
<body>

<!-- Sidebar -->
<div class="sidebar">
    <h2>LMB Freight</h2>
    <ul>
        <li><a href="#">Dashboard</a></li>
        <li>
    <a href="{% url 'carrier_list' %}">Carriers</a>
    <ul style="margin-left: 15px; list-style-type: disc;">
        {% for carrier in carriers %}
            <li><a href="{% url 'carrier_detail' carrier.pk %}">{{ carrier.name }}</a></li>
        {% empty %}
            <li><em>No carriers yet</em></li>
        {% endfor %}
        <li><a href="{% url 'add_carrier' %}" style="color:#49a942;">+ Add Carrier</a></li>
    </ul>
</li>

    </ul>
</div>

<!-- Main content -->
<div class="main-content">
    <div class="notification" id="notification"></div>
    <h1>LMB Dashboard</h1>

    <!-- Stats cards -->
    <div class="stats">
        <div class="card">
            <h3>Total Orders</h3>
            <p>{{ total_orders }}</p>
        </div>
        <div class="card">
            <h3>Open POs</h3>
            <p>{{ pending_shipments }}</p>
        </div>
        <div class="card">
            <h3>Unassigned</h3>
             <p>{{ unassigned }}</p>
        </div>
    </div>

    <!-- Controls -->
    <div class="controls">
        <a href="{% url 'add_order' %}">Create order</a>
        <input type="text" id="search" placeholder="Search orders...">
        <select id="rows-per-page">
            <option value="25">25 rows</option>
            <option value="50">50 rows</option>
            <option value="100">100 rows</option>
        </select>
    </div>

    <!-- Orders Table -->
    <table>
        <thead>
            <tr>
                <th>Customer Name</th>
                <th>PO Number</th>
                <th>Ship Date</th>
                <th>Order Number</th>
                <th>From</th>
                <th>Carrier</th>
                <th>Cost</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody id="orders-tbody">
            {% for order in orders %}
            <tr data-id="{{ order.id }}">
                <td contenteditable="true" data-field="customer_name">{{ order.customer_name }}</td>
                <td contenteditable="true" data-field="po_number">{{ order.po_number }}</td>
                <td contenteditable="true" data-field="ship_date">{{ order.ship_date|date:"Y-m-d" }}</td>
                <td contenteditable="true" data-field="order_number">{{ order.order_number }}</td>
                <td contenteditable="true" data-field="location_from">{{ order.location_from }}</td>
                <td contenteditable="true" data-field="carrier">{{ order.carrier }}</td>
                <td contenteditable="true" data-field="cost">{{ order.cost }}</td>
                <td>
                    <select class="status-select" data-id="{{ order.id }}">
                        <option value="open" {% if order.status == 'open' %}selected{% endif %}>Open</option>
                        <option value="closed" {% if order.status == 'closed' %}selected{% endif %}>Closed</option>
                    </select>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Chart placeholder -->
    <div class="chart-container">
        <canvas id="ordersChart" width="400" height="150"></canvas>
    </div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
    const table = document.querySelector('table');
    const notification = document.getElementById('notification');

    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let c of cookies) {
                const cookie = c.trim();
                if (cookie.startsWith(name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    function showNotification(message, type='success') {
        notification.textContent = message;
        notification.style.backgroundColor = type==='error' ? '#f44336' : '#4CAF50';
        notification.classList.add('show');
        setTimeout(()=>notification.classList.remove('show'), 3000);
    }

    // Editable table cells
    table.addEventListener('blur', (event) => {
        const cell = event.target;
        if (cell.tagName === 'TD' && cell.hasAttribute('contenteditable')) {
            const row = cell.closest('tr');
            const orderId = row.dataset.id;
            const fieldName = cell.dataset.field;
            const newValue = cell.textContent;

            fetch('/dashboard/update-order/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: JSON.stringify({ id: orderId, field: fieldName, value: newValue })
            })
            .then(res => res.json())
            .then(result => {
                if (result.status === 'success') showNotification('Order updated successfully!');
                else showNotification('Error: ' + result.message, 'error');
            })
            .catch(err => showNotification('Network error: ' + err, 'error'));
        }
    }, true);

    // Status dropdown update
    document.querySelectorAll('.status-select').forEach(select => {
        select.addEventListener('change', (event) => {
            const newStatus = event.target.value;
            const orderId = event.target.dataset.id;

            fetch('/dashboard/update-order/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: JSON.stringify({ id: orderId, field: 'status', value: newStatus })
            })
            .then(res => res.json())
            .then(result => {
                if (result.status === 'success') showNotification('Order status updated!');
                else showNotification('Error: ' + result.message, 'error');
            })
            .catch(err => showNotification('Network error: ' + err, 'error'));
        });
    });

    // Table search
    document.getElementById('search').addEventListener('input', e => {
        const filter = e.target.value.toLowerCase();
        document.querySelectorAll('#orders-tbody tr').forEach(tr => {
            tr.style.display = [...tr.children].some(td => td.textContent.toLowerCase().includes(filter)) ? '' : 'none';
        });
    });

    // Rows-per-page filter
    document.getElementById('rows-per-page').addEventListener('change', e => {
        const maxRows = parseInt(e.target.value);
        const rows = document.querySelectorAll('#orders-tbody tr');
        rows.forEach((tr, idx) => {
            tr.style.display = idx < maxRows ? '' : 'none';
        });
    });

    // Example chart
    const ctx = document.getElementById('ordersChart').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Jan','Feb','Mar','Apr'],
            datasets: [{
                label: 'Orders',
                data: [12, 19, 3, 5],
                backgroundColor: '#49a942'
            }]
        }
    });
});
</script>

</body>
</html>
